<div class="p-6">
  <!-- ✅ Alerta -->
  @if (alerta.tipo) {
    <div
      class="p-4 mb-4 text-sm font-medium transition-all duration-300 rounded-lg shadow"
      [ngClass]="{
        'bg-green-100 text-green-800 border border-green-300': alerta.tipo === 'success',
        'bg-red-100 text-red-800 border border-red-300': alerta.tipo === 'error'
      }"
    >
      {{ alerta.mensaje }}
    </div>
  }

  <!-- ✅ Botón principal -->
  <button
    class="px-5 py-2 font-semibold text-white transition bg-red-600 rounded-lg shadow-md hover:bg-red-700"
    (click)="abrirModal()"
  >
    + Nuevo Tipo de Ambiente
  </button>
</div>

<!-- ✅ Modal -->
@if (modalVisible) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"
  >
    <div class="w-full max-w-md overflow-hidden transition-all transform bg-white shadow-lg rounded-2xl">
      <!-- Header -->
      <div class="flex items-center justify-between px-6 py-3 text-white bg-red-600">
        <h3 class="text-lg font-semibold">
          {{ editando ? 'Editar Tipo de Ambiente' : 'Nuevo Tipo de Ambiente' }}
        </h3>
        <button (click)="cerrarModal()" class="text-white hover:text-gray-200">✖</button>
      </div>

      <!-- Formulario -->
      <form (ngSubmit)="guardarTipoAmbiente()" #formAmbiente="ngForm" class="p-6 space-y-4">
        <!-- Nombre -->
        <div>
          <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="nuevoTipo.nombre"
            required
            class="block w-full px-3 py-2 mt-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:outline-none"
            placeholder="Ej: Laboratorio, Aula, etc."
          />
        </div>

        <!-- Colores -->
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-700">Color</label>

          <!-- Paleta básica -->
          <div class="flex flex-wrap gap-2 mb-3">
            @for (color of coloresBasicos; track color.hex) {
              <button
                type="button"
                class="w-8 h-8 transition border-2 rounded-full"
                [ngStyle]="{ 'background-color': color.hex }"
                [ngClass]="{
                  'border-red-600 ring-2 ring-red-400': color.hex === nuevoTipo.colorhex
                }"
                (click)="seleccionarColor(color)"
                [title]="color.nombre"
              ></button>
            }
          </div>

          <!-- Botón paleta extendida -->
          <button
            type="button"
            (click)="alternarPaleta()"
            class="text-sm text-red-600 underline hover:text-red-800"
          >
            {{ mostrarPaletaExtendida ? 'Ocultar más colores' : 'Mostrar más colores' }}
          </button>

          <!-- Paleta extendida -->
          @if (mostrarPaletaExtendida) {
            <div class="flex flex-wrap gap-2 mt-3">
              @for (color of coloresExtendidos; track color.hex) {
                <button
                  type="button"
                  class="w-8 h-8 transition border-2 rounded-full"
                  [ngStyle]="{ 'background-color': color.hex }"
                  [ngClass]="{
                    'border-red-600 ring-2 ring-red-400': color.hex === nuevoTipo.colorhex
                  }"
                  (click)="seleccionarColor(color)"
                  [title]="color.nombre"
                ></button>
              }
            </div>
          }

          <!-- Selector personalizado -->
          <div class="mt-4">
            <label class="block mb-1 text-sm text-gray-700">Color personalizado</label>
            <input
              name="colorPersonalizado"
              type="color"
              [(ngModel)]="colorPersonalizado"
              (input)="seleccionarColorPersonalizado()"
              class="h-10 border border-gray-300 rounded-md cursor-pointer w-14"
            />
            @if (esColorPersonalizado()) {
              <div
                class="inline-block px-3 py-1 ml-3 text-xs font-semibold rounded-full"
                [ngStyle]="{ 'background-color': nuevoTipo.colorhex, color: '#fff' }"
              >
                {{ nuevoTipo.colorhex }}
              </div>
            }
          </div>
        </div>

        <!-- Footer -->
        <div class="flex justify-end gap-3 pt-4 border-t">
          <button
            type="button"
            (click)="cerrarModal()"
            class="px-4 py-2 text-gray-700 transition border border-gray-300 rounded-lg hover:bg-gray-100"
          >
            Cancelar
          </button>
          <button
            type="submit"
            [disabled]="formAmbiente.invalid || !colorValido"
            class="px-5 py-2 text-white transition bg-red-600 rounded-lg shadow-md hover:bg-red-700 disabled:opacity-50"
          >
            {{ editando ? 'Actualizar' : 'Guardar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}
