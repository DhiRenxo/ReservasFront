<div class="container mt-4">

  <h2 class="mb-4 text-primary text-center">Gestión de Ambientes</h2>

  <!-- Botón para crear ambiente -->
  <div class="text-end mb-3">
    <button class="btn btn-success" (click)="mostrarFormulario()">
      + Crear nuevo ambiente
    </button>
  </div>

  <!-- Listado de ambientes -->
  <div *ngIf="!mostrarForm">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Código</th>
          <th>Tipo</th>
          <th>Capacidad</th>
          <th>Ubicación</th>
          <th>Equipamiento</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let amb of ambientes">
          <td>{{ amb.codigo }}</td>
          <td>{{ obtenerNombreTipo(amb.tipoid) }}</td>
          <td>{{ amb.capacidad }}</td>
          <td>{{ amb.ubicacion }}</td>
          <td>{{ amb.equipamiento }}</td>
          <td>
            <span [class.text-success]="amb.activo"> 
              {{ amb.activo ? 'Activo' : 'Inactivo' }} 
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-warning me-2">Editar</button>
            <button class="btn btn-sm btn-secondary" (click)="cambiarEstado(amb)">
              {{ amb.activo ? 'Desactivar' : 'Activar' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Formulario para nuevo ambiente -->
  <div *ngIf="mostrarForm">
    <form (ngSubmit)="guardarAmbiente()" #formAmbiente="ngForm" class="border p-4 rounded shadow bg-light">
      <h4 class="mb-3">Nuevo Ambiente</h4>

      <!-- Código -->
      <div class="mb-3">
        <label>Código:</label>
        <input type="text" class="form-control" required [(ngModel)]="nuevoAmbiente.codigo" name="codigo">
      </div>

      <!-- Tipo de ambiente y botón para crear nuevo tipo -->
      <div class="mb-3 d-flex align-items-center gap-3">
        <div class="flex-grow-1">
          <label>Tipo de ambiente:</label>
          <select class="form-select" [(ngModel)]="nuevoAmbiente.tipoid" name="tipoid" required>
            <option *ngFor="let tipo of tiposAmbiente" [value]="tipo.id">
              {{ tipo.nombre }}
            </option>
          </select>
        </div>
        <button type="button" class="btn btn-outline-primary mt-4" data-bs-toggle="modal" data-bs-target="#modalTipoAmbiente">
          + Tipo
        </button>
      </div>

      <!-- Capacidad -->
      <div class="mb-3">
        <label>Capacidad:</label>
        <input type="number" class="form-control" required [(ngModel)]="nuevoAmbiente.capacidad" name="capacidad">
      </div>

      <!-- Ubicación -->
      <div class="mb-3">
        <label>Ubicación:</label>
        <input type="text" class="form-control" required [(ngModel)]="nuevoAmbiente.ubicacion" name="ubicacion">
      </div>

      <!-- Equipamiento -->
      <div class="mb-3">
        <label>Equipamiento:</label>
        <input type="text" class="form-control" required [(ngModel)]="nuevoAmbiente.equipamiento" name="equipamiento">
      </div>

      <div class="text-end">
        <button type="submit" class="btn btn-success me-2" [disabled]="formAmbiente.invalid">Guardar</button>
        <button type="button" class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
      </div>
    </form>
  </div>

  <!-- Modal reutilizado de TipoAmbiente -->
  <app-tipoambiente></app-tipoambiente>

</div>
