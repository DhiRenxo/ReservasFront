<div class="p-6 mx-auto max-w-7xl">
  <!-- Título -->
  <h2 class="mb-6 text-3xl font-bold text-center text-red-600">
    Gestión de Ambientes
  </h2>

  <!-- Botón principal -->
  <div class="flex justify-end mb-4">
    <button
      class="px-4 py-2 font-medium text-white transition bg-red-600 rounded-lg shadow hover:bg-red-700"
      (click)="toggleFormulario()"
    >
      {{ mostrarForm() ? 'Cerrar formulario' : '+ Crear nuevo ambiente' }}
    </button>
  </div>

  <!-- Listado -->
  @if (!mostrarForm()) {
    <div class="overflow-x-auto shadow rounded-xl">
      <table class="min-w-full bg-white border border-gray-200">
        <thead class="text-white bg-red-600">
          <tr>
            <th class="px-4 py-2 text-left">Código</th>
            <th class="px-4 py-2 text-left">Tipo</th>
            <th class="px-4 py-2 text-left">Capacidad</th>
            <th class="px-4 py-2 text-left">Ubicación</th>
            <th class="px-4 py-2 text-left">Equipamiento</th>
            <th class="px-4 py-2 text-left">Estado</th>
            <th class="px-4 py-2 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (amb of ambientes(); track amb.id) {
            <tr class="transition border-b hover:bg-gray-50">
              <td class="px-4 py-2">{{ amb.codigo }}</td>
              <td class="px-4 py-2">{{ obtenerNombreTipo(amb.tipoid) }}</td>
              <td class="px-4 py-2">{{ amb.capacidad }}</td>
              <td class="px-4 py-2">{{ amb.ubicacion }}</td>
              <td class="px-4 py-2">{{ amb.equipamiento }}</td>
              <td class="px-4 py-2">
                <span
                  class="font-semibold"
                  [class.text-green-600]="amb.activo"
                  [class.text-red-600]="!amb.activo"
                >
                  {{ amb.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td class="px-4 py-2 space-x-2 text-center">
                <button
                  class="px-3 py-1 text-white bg-yellow-500 rounded-md hover:bg-yellow-600"
                  (click)="editarAmbiente(amb)"
                >
                  Editar
                </button>
                <button
                  class="px-3 py-1 text-white bg-gray-600 rounded-md hover:bg-gray-700"
                  (click)="cambiarEstado(amb)"
                >
                  {{ amb.activo ? 'Desactivar' : 'Activar' }}
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Formulario -->
  @if (mostrarForm()) {
    <div class="p-6 mt-6 bg-white border shadow rounded-xl">
      <h3 class="mb-4 text-xl font-semibold text-red-600">
        {{ editando() ? 'Editar Ambiente' : 'Nuevo Ambiente' }}
      </h3>

      <form
        (ngSubmit)="guardarAmbiente()"
        #formAmb="ngForm"
        class="grid gap-4 md:grid-cols-2"
      >
        <div>
          <label class="block mb-1 font-medium text-gray-700">Código</label>
          <input
            type="text"
            name="codigo"
            required
            [(ngModel)]="nuevoAmbiente().codigo"
            class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-red-500"
          />
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Tipo de ambiente</label>
          <select
            name="tipoid"
            required
            [(ngModel)]="nuevoAmbiente().tipoid"
            class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-red-500"
          >
            <option value="">Seleccione un tipo</option>
            @for (tipo of tiposAmbiente(); track tipo.id) {
              <option [value]="tipo.id">{{ tipo.nombre }}</option>
            }
          </select>
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Capacidad</label>
          <input
            type="number"
            name="capacidad"
            required
            [(ngModel)]="nuevoAmbiente().capacidad"
            class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-red-500"
          />
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Ubicación</label>
          <input
            type="text"
            name="ubicacion"
            required
            [(ngModel)]="nuevoAmbiente().ubicacion"
            class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-red-500"
          />
        </div>

        <div class="md:col-span-2">
          <label class="block mb-1 font-medium text-gray-700">Equipamiento</label>
          <input
            type="text"
            name="equipamiento"
            required
            [(ngModel)]="nuevoAmbiente().equipamiento"
            class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-red-500"
          />
        </div>

        <div class="mt-4 text-right md:col-span-2">
          <button
            type="submit"
            class="px-4 py-2 mr-2 text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50"
            [disabled]="formAmb.invalid"
          >
            {{ editando() ? 'Actualizar' : 'Guardar' }}
          </button>
          <button
            type="button"
            class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300"
            (click)="toggleFormulario()"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Modal de TipoAmbiente -->
  <app-tipoambiente (tipoCreado)="onTipoCreado($event)"></app-tipoambiente>
</div>
