<div class="home-container" *ngIf="!cargando">
  <div *ngIf="usuario; else noUser" class="row gx-3">
    
    <div class="col-md-4 d-flex flex-column gap-3">
      <div class="card shadow-sm flex-shrink-0">
        <div class="card-body text-center">
          <img *ngIf="usuario.foto_url; else defaultFoto"
               [src]="usuario.foto_url"
               alt="Foto perfil"
               class="rounded-circle mb-3"
               width="120" height="120">
          <ng-template #defaultFoto>
            <div class="rounded-circle bg-secondary d-flex justify-content-center align-items-center text-white mx-auto mb-3"
                 style="width:120px; height:120px; font-size:40px;">
              {{ usuario.nombre.charAt(0).toUpperCase() }}
            </div>
          </ng-template>

          <h4 class="mb-1">{{ usuario.nombre }}</h4>
          <p class="text-muted mb-1">{{ rol?.nombre || 'Sin rol asignado' }}</p>
          <small *ngIf="usuario.email_verificado" class="text-success d-block mb-2">
            âœ” Email verificado
          </small>

          <div class="actions">
            <button class="btn btn-sm btn-primary">Seguir</button>
            <button class="btn btn-sm btn-outline-secondary">Mensaje</button>
          </div>
        </div>
      </div>

      <div class="card shadow-sm flex-grow-1">
        <div class="card-body p-0">
          <h6 class="p-3">ðŸ”— Enlaces</h6>
          <ul class="list-group list-group-flush enlaces-list">
            <li class="list-group-item"><i class="bi bi-globe me-2"></i> Website</li>
            <li class="list-group-item"><i class="bi bi-github me-2"></i> Github</li>
            <li class="list-group-item"><i class="bi bi-twitter me-2"></i> Twitter</li>
            <li class="list-group-item"><i class="bi bi-instagram me-2"></i> Instagram</li>
            <li class="list-group-item"><i class="bi bi-facebook me-2"></i> Facebook</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-8 d-flex flex-column gap-3">
      <div class="card shadow-sm flex-shrink-0">
        <div class="card-body">
          <h5>Detalles del perfil</h5>

          <form (ngSubmit)="enviarDatos()">
            <div class="mb-2">
              <label>Nombre completo</label>
              <input class="form-control" [(ngModel)]="usuario!.nombre" name="nombre">
            </div>
            <div class="mb-2">
              <label>Correo</label>
              <input class="form-control" [(ngModel)]="usuario!.correo" name="correo">
            </div>
            <div class="mb-2">
              <label>TelÃ©fono</label>
              <input class="form-control" [(ngModel)]="telefono" name="telefono">
            </div>
            <div class="mb-2">
              <label>DirecciÃ³n</label>
              <input class="form-control" [(ngModel)]="calleNombre" name="direccion" placeholder="Ej: Av. Principal 123">
            </div>

            <div class="text-end mt-2">
              <button type="submit" class="btn btn-success btn-sm">ðŸ’¾ Guardar cambios</button>
            </div>
          </form>
        </div>
      </div>

      <div *ngIf="rol?.nombre?.toLowerCase() === 'docente'" class="card shadow-sm flex-shrink-0">
        <div class="card-body">
          <h5>ðŸŽ“ CÃ³digo Docente</h5>
          <p *ngIf="usuario?.cod_docente; else sinCodigo" class="text-success">
            CÃ³digo actual: <strong>{{ usuario.cod_docente }}</strong>
          </p>
          <ng-template #sinCodigo>
            <p class="text-muted">AÃºn no has registrado tu cÃ³digo docente.</p>
          </ng-template>
          <div class="input-group mt-2">
            <input type="text"
                   [(ngModel)]="nuevoCodDocente"
                   name="codDocente"
                   class="form-control"
                   placeholder="Ingrese nuevo cÃ³digo docente">
            <button class="btn btn-primary" type="button" (click)="actualizarCodigoDocente()">
              Actualizar
            </button>
          </div>
          <p *ngIf="mensajeCodigo" class="mt-2 text-info">{{ mensajeCodigo }}</p>
        </div>
      </div>

      <div class="row flex-grow-1">
        <div *ngIf="rol?.nombre?.toLowerCase() === 'docente'" class="col-md-6 d-flex flex-column">
          <div class="card shadow-sm flex-grow-1">
            <div class="card-body cursos-list">
              <h6>ðŸ“š Cursos asignados</h6>
              <ul class="list-group list-group-flush">
                <li *ngFor="let curso of cursosAsignados" class="list-group-item">
                  {{ curso.plan }} - Ciclo: {{ curso.ciclo }} 
                  <br><small class="text-muted">Secciones: {{ curso.cantidad_secciones }}</small>
                </li>
                <li *ngIf="cursosAsignados.length === 0" class="list-group-item text-muted">
                  No tienes cursos asignados.
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div *ngIf="rol?.nombre?.toLowerCase() === 'administrador' || rol?.nombre?.toLowerCase() === 'coordinador'" 
             class="col-md-6 d-flex flex-column">
          <div class="card shadow-sm flex-grow-1">
            <div class="card-body asignaciones-list">
              <h6>ðŸ—‚ Asignaciones</h6>
              <ul class="list-group list-group-flush">
                <li *ngFor="let asignacion of asignaciones" class="list-group-item">
                  {{ asignacion.plan }} - {{ asignacion.ciclo }} 
                  <br><small [class.text-success]="asignacion.estado" [class.text-danger]="!asignacion.estado">
                    {{ asignacion.estado ? 'Activo' : 'Inactivo' }}
                  </small>
                </li>
                <li *ngIf="asignaciones.length === 0" class="list-group-item text-muted">
                  No hay asignaciones disponibles.
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="rol?.nombre?.toLowerCase() === 'administrador'" class="card shadow-sm flex-shrink-0">
        <div class="card-body text-center">
          <button class="btn btn-primary me-2" (click)="toggleModalGestionRoles()">Gestionar roles</button>
          <button class="btn btn-success" (click)="toggleModalActualizarRoles()">Actualizar roles de usuarios</button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noUser>
    <p class="text-muted">No hay informaciÃ³n de usuario disponible.</p>
  </ng-template>
</div>
