<div class="container mt-4">
  <h3>Gestión de Asignaciones</h3>

  <form (ngSubmit)="editMode ? updateAsignacion() : createAsignacion()" class="mb-4">
    <div class="mb-2">
      <label>Carrera:</label>
      <select [(ngModel)]="asignacion.carreraid" name="carreraid" class="form-control" required>
        <option value="" disabled selected>-- Seleccione Carrera --</option>
        <option *ngFor="let carrera of carreras" [value]="carrera.id">
          {{ carrera.nombre }} ({{ carrera.nomenglatura }})
        </option>
      </select>
    </div>

    <div class="mb-2">
      <label>Plan:</label>
      <select [(ngModel)]="asignacion.plan" name="plan" class="form-control" required>
        <option value="" disabled selected>-- Seleccione Plan --</option>
        <option value="2019">2019</option>
        <option value="2023">2023</option>
        <option value="2024">2024</option>
      </select>
    </div>

    <div class="mb-2">
      <label>Ciclo:</label>
      <select [(ngModel)]="asignacion.ciclo" name="ciclo" class="form-control" required>
        <option value="" disabled selected>-- Seleccione Ciclo --</option>
        <option *ngFor="let c of ciclos" [value]="c">{{ c }}</option>
      </select>
    </div>

    <div class="mb-2">
      <label>Modalidad:</label>
      <select [(ngModel)]="asignacion.modalidad" name="modalidad" class="form-control">
        <option value="" disabled selected>-- Seleccione Modalidad --</option>
        <option value="PRESENCIAL">Presencial</option>
        <option value="DISTANCIA">Distancia</option>
        <option value="SEMIPRESENCIAL">SemiPresencial</option>
      </select>
    </div>

    <div class="mb-2">
      <label>Fecha de Inicio:</label>
      <input type="date" class="form-control" [(ngModel)]="asignacion.fecha_inicio" name="fecha_inicio" required>
    </div>

    <button type="submit" class="btn btn-success">
      {{ editMode ? 'Actualizar' : 'Crear' }}
    </button>
    <button type="button" class="btn btn-secondary ms-2" (click)="resetForm()">Cancelar</button>
  </form>

  <table class="table table-bordered table-hover">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Carrera</th>
        <th>Plan</th>
        <th>Ciclo</th>
        <th>Modalidad</th>
        <th>Secciones</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let asig of asignaciones">
        <td>{{ asig.id }}</td>
        <td>{{ carreraMap[asig.carreraid] || '---' }}</td>
        <td>{{ asig.plan }}</td>
        <td>{{ asig.ciclo }}</td>
        <td>{{ asig.modalidad }}</td>
        <td>{{ asig.cantidad_secciones }}</td>
        <td>
          <span [class.text-success]="asig.estado" [class.text-danger]="!asig.estado">
            {{ asig.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
        <td>
          <button class="btn btn-info btn-sm ms-2" (click)="openModal(asig)">Ver Cursos</button>
          <button class="btn btn-warning btn-sm" (click)="editAsignacion(asig)">Editar</button>
          <button class="btn btn-sm ms-2" [ngClass]="asig.estado ? 'btn-danger' : 'btn-success'" (click)="toggleEstado(asig)">
            {{ asig.estado ? 'Inactivar' : 'Activar' }}
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="modal fade" id="cursoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalle de Asignación</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p *ngIf="modalData"><strong>Carrera:</strong> {{ carreraMap[modalData.carreraid] }}</p>
          <p><strong>Plan:</strong> {{ modalData?.plan }}</p>
          <p><strong>Ciclo:</strong> {{ modalData?.ciclo }}</p>
          <p><strong>Modalidad:</strong> {{ modalData?.modalidad }}</p>

          <h6>Actualizar Cursos</h6>
          <form (ngSubmit)="actualizarCursos()">
            <div class="form-check" *ngFor="let curso of cursosModal">
              <input class="form-check-input" type="checkbox" [id]="'curso-' + curso.id" [(ngModel)]="curso.selected" name="curso{{curso.id}}">
              <label class="form-check-label" [for]="'curso-' + curso.id">{{ curso.codigo }} - {{ curso.nombre }}</label>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Actualizar Cursos</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
