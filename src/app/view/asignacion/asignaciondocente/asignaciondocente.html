<div class="container mt-4" *ngIf="!loading && asignaciones.length > 0; else cargando">
  <h3>Asignación de docentes</h3>

  <!-- Navegación -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-primary" (click)="anterior()" [disabled]="currentIndex === 0">
      &larr;
      {{ currentIndex > 0 ? getCarreraNombre(asignaciones[currentIndex - 1].carreraid) : '' }}
    </button>

    <strong class="fs-5">
      Carrera: {{ asignacionActual ? getCarreraNombre(asignacionActual.carreraid) : '' }}
    </strong>

    <button class="btn btn-outline-primary" (click)="siguiente()" [disabled]="currentIndex === asignaciones.length - 1">
      {{ currentIndex < asignaciones.length - 1 ? getCarreraNombre(asignaciones[currentIndex + 1].carreraid) : '' }}
      &rarr;
    </button>
  </div>

  <!-- Cuadro de asignación -->
  <div class="border p-3 rounded shadow-sm" *ngIf="asignacionActual">
    <h5>
      Asignación #{{ asignacionActual.id }}
      <small class="text-muted">({{ asignacionActual.fecha_asignacion | date:'short' }})</small>
    </h5>
    <p class="d-flex align-items-center gap-3 flex-wrap">
      <span><strong>Plan:</strong> {{ asignacionActual.plan }}</span>
      <span><strong>Ciclo:</strong> {{ asignacionActual.ciclo }}</span>
      <span class="d-flex align-items-center">
        <strong class="me-2">Cantidad de secciones:</strong>
        <input type="number" class="form-control form-control-sm w-auto"
               [(ngModel)]="asignacionActual.cantidad_secciones" min="1" />
        <button class="btn btn-sm btn-success ms-2" (click)="guardarCantidadSecciones(asignacionActual)">
          Guardar
        </button>
      </span>
    </p>

    <!-- Tabla -->
    <table class="table table-bordered table-hover"
          *ngIf="asignacionActual && asignacionActual.cursos?.length && asignacionActual.docentes?.length; else cargarCursosMsg">
      <thead class="table-light">
        <tr>
          <th>Curso</th>
          <th>Horas</th>
          <th>Sección</th>
          <th>Docente asignado</th>
          <th>Horas Docente</th>
          <th>Horas Actuales</th>
          <th>Horas Temporales</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let curso of asignacionActual!.cursos; let ci = index">
          <tr *ngFor="let sec of [].constructor(asignacionActual!.cantidad_secciones); let si = index">
            <td>{{ curso.nombre }}</td>
            <td>{{ curso.horas }}</td>
            <td>Sección {{ si + 1 }}</td>
            <td>
              <select class="form-select"
                      [(ngModel)]="asignacionActual!.docentes![ci * asignacionActual!.cantidad_secciones + si].id"
                      (change)="onDocenteChange(asignacionActual!, ci * asignacionActual!.cantidad_secciones + si)">
                <option value="0">-- Seleccione docente --</option>
                <option *ngFor="let doc of docentes" [value]="doc.id">{{ doc.nombre }}</option>
              </select>
            </td>
            <td>{{ asignacionActual!.docentes![ci * asignacionActual!.cantidad_secciones + si].horassemanal || 0 }}</td>
            <td>{{ asignacionActual!.docentes![ci * asignacionActual!.cantidad_secciones + si].horasactual || 0 }}</td>
            <td>{{ asignacionActual!.docentes![ci * asignacionActual!.cantidad_secciones + si].horastemporales || 0 }}</td>
          </tr>
        </ng-container>
      </tbody>
    </table>


    <ng-template #cargarCursosMsg>
      <div class="text-center p-3">
        <button class="btn btn-sm btn-secondary" (click)="cargarCursos(asignacionActual)">
          Cargar cursos
        </button>
      </div>
    </ng-template>

    <button class="btn btn-primary mt-2" (click)="guardarCambios(asignacionActual)">
      Guardar cambios
    </button>
  </div>
</div>

<ng-template #cargando>
  <div class="text-center mt-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2">Cargando datos...</p>
  </div>
</ng-template>
