<div *ngFor="let asig of asignaciones" class="card my-3 shadow-sm">
  <div class="card-body">
    <h5 class="card-title">
      Plan: {{ asig.plan }} | Modalidad: {{ asig.modalidad }} |
      Carrera:
      {{ asig.carreraid && carrerasMap[asig.carreraid] 
          ? carrerasMap[asig.carreraid].nombre 
          : 'Sin carrera' }}
    </h5>

    <div *ngIf="cursosPorAsignacion[asig.id]">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Curso</th>
            <th>SecciÃ³n</th>
            <th>Docente</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
        <ng-container *ngFor="let curso of cursosPorAsignacion[asig.id]">
          <tr *ngIf="!curso.es_bloque || (curso.es_bloque && curso.activo)">
            <td>
              {{ curso.curso_id && cursosMap[curso.curso_id] 
                  ? cursosMap[curso.curso_id].nombre 
                  : ('Curso ' + curso.curso_id) }}
            </td>
            <td>{{ curso.seccion }}</td>
            <td>
              {{ curso.docente_id && docentesMap[curso.docente_id] 
                  ? docentesMap[curso.docente_id].nombre 
                  : ('Docente ' + curso.docente_id) }}
            </td>
            <td>
              <button class="btn btn-primary btn-sm" 
                      (click)="curso.docente_id && abrirModal(curso.docente_id, asig.modalidad!)">
                Ver Disponibilidad
              </button>
            </td>
          </tr>
        </ng-container>
      </tbody>

      </table>

      <!-- âœ… BotÃ³n de notificaciÃ³n agregado aquÃ­ -->
      <button class="btn btn-success btn-sm mt-2"
              (click)="enviarCorreos(asig.id)">
        ðŸ“© Notificar Docentes
      </button>

    </div>
  </div>
</div>


<!-- âœ… Modal solo lectura -->
<div class="modal fade show" tabindex="-1" role="dialog" *ngIf="mostrarModal" style="display:block;">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Disponibilidad del Docente</h5>
        <button type="button" class="btn-close" (click)="cerrarModal()"></button>
      </div>

      <div class="modal-body">

        <!-- SelecciÃ³n de modalidad -->
        <div class="row mb-3">
          <div class="col-auto">
            <label class="fw-bold me-2">Modalidad:</label>
            <select class="form-select"
                    [value]="modalidadSeleccionada"
                    (change)="seleccionarModalidad($any($event.target).value)">
              <option value="PRESENCIAL">PRESENCIAL</option>
              <option value="SEMIPRESENCIAL">SEMIPRESENCIAL</option>
              <option value="DISTANCIA">DISTANCIA</option>
            </select>
          </div>

          <!-- Turno -->
          <div class="col-auto">
            <label class="fw-bold me-2">Turno:</label>
            <select class="form-select"
                    [value]="turnoSeleccionado ?? ''"
                    (change)="seleccionarTurno($any($event.target).value)">
              <option value="" disabled>Seleccionar</option>
              <option *ngFor="let turno of getTurnosDisponibles()" [value]="turno">
                {{ turno }}
              </option>
            </select>
          </div>
        </div>

        <!-- ðŸ“Œ Matriz visual de disponibilidad -->
        <div class="table-responsive mt-3">
          <table class="table table-bordered align-middle text-center disponibilidad-table">
            <thead class="table-primary">
              <tr>
                <th>Hora</th>
                <th *ngFor="let dia of dias">{{ dia }}</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let bloque of (turnoSeleccionado ? generarBloques(turnoSeleccionado) : [])">
                <td class="fw-bold bg-light">{{ bloque }}</td>

                <td *ngFor="let dia of dias"
                    [class.slot-disponible]="disponibilidadSeleccionada[dia][bloque]"
                    [class.slot-vacio]="!disponibilidadSeleccionada[dia][bloque]">

                </td>
              </tr>
            </tbody>
          </table>
        </div>


      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
